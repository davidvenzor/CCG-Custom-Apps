sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,i,s){"use strict";return e.extend("CCGSDGRADINGAPP.ZSD_GRADINGAPP.controller.initial",{onInit:function(){this.onLandingPage()},onLandingPage:function(){this.getView().byId("idSalesOrder").setSelectedKey("");this.getView().byId("idLineItem").setSelectedKey("");var e=new sap.ui.model.json.JSONModel;this.getView().setModel(e,"InitModel");var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();var s=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.oSalesID),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.oLineId)];var r=[new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"I")];i.read("/getInitialLineItemsSet",{filters:r,success:function(e,i){t.setData(e);this.getView().getModel("InitModel").setData(e.results);this.getView().getModel("InitModel").refresh()}.bind(this),error:function(){}});this.onRefreshSo()},onFetchDetails:function(e){this.oSalesID=this.getView().byId("idSalesOrder").getValue();this.oLineID=this.getView().byId("idLineItem")._lastValue;if(this.oLineID===""){s.error("Please select Lineitem")}if(this.oLineID!==""){var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();var r=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.oSalesID),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.oLineID),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"L")];var o=" ";i.read("/Grade_MARADATASet",{filters:r,success:function(e,i){t.setData(e);if(e.results.length!==0){if(e.results[0].Exflag==="X"){s.error("Verification not yet completed")}else{if(e.results[0].Lifsk==="50"){o="X";s.error("Delivery Block active for Payment")}else{if(e.results[0].Zterm!=="0001"&&(e.results[0].Cmgst==="B"||e.results[0].Cmgst==="C")){o="X";s.error("Order have credit limit exceeded,please remove credit block ")}else{if(e.results[0].Lifsk==="60"){o="X";s.error("Delivery Block active")}else{if(o!=="X"){var r=this.getOwnerComponent().getRouter();r.navTo("grading",{SalesId:this.oSalesID,LineId:this.oLineID})}}}}}}this.getView().getModel("initMaraData").setData(e.results[0]);this.getView().getModel("initMaraData").refresh()}.bind(this),error:function(){}})}},onRefreshSo:function(e){this.getView().byId("idSalesOrder").setSelectedKey("");this.getView().byId("idLineItem").setSelectedKey("");var t=new sap.ui.model.json.JSONModel;this.getView().setModel(t,"initMaraData");var i=new sap.ui.model.json.JSONModel;var s=this.getOwnerComponent().getModel();var r=[new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"I")];s.read("/getInitialLineItemsSet",{filters:r,success:function(e,t){i.setData(e);this.getView().getModel("InitModel").setData(e.results);this.getView().getModel("InitModel").refresh()}.bind(this),error:function(){}})},onLineitemFetch:function(e){this.oSalesID=this.getView().byId("idSalesOrder").getValue();var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();var r=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.oSalesID),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.oLineID)];i.read("/Grade_MARADATASet",{filters:r,success:function(e,i){t.setData(e);this.getView().getModel("initMaraData").setData(e.results[0]);this.getView().getModel("initMaraData").refresh()}.bind(this),error:function(){}});var o=new sap.ui.model.json.JSONModel;this.getView().setModel(o,"InitModel");var l=new sap.ui.model.json.JSONModel;var a=this.getOwnerComponent().getModel();var n=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.oSalesID),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"P")];a.read("/getInitialLineItemsSet",{filters:n,success:function(e,t){l.setData(e);if(e.results.length===0){s.error("Please select Valid Sales Order number")}this.getView().getModel("InitModel").setData(e.results);this.getView().getModel("InitModel").refresh()}.bind(this),error:function(){}})}})});