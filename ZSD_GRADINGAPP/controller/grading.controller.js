sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/Fragment","sap/m/PDFViewer","sap/m/Dialog","sap/m/Button","sap/m/library"],function(e,t,i,s,d,r,a,l,o,n,g){"use strict";return e.extend("CCGSDGRADINGAPP.ZSD_GRADINGAPP.controller.grading",{onAfterRendering:function(e){var t=this.getView().byId("idGrade");jQuery.sap.delayedCall(200,this,function(){t.focus()})},onInit:function(){var e=new sap.ui.model.json.JSONModel;this.getView().setModel(e,"oMaraTempModel");var t={Matnr:" ",Maktx:" ",ZCsgSportsCode:" ",ZCsgMakerCode:" ",ZCsgSetCode:" ",ZCardYear:" ",ZPlayer:" ",ZPrntdAutographFlag:" ",ZCsgCardAttrib1Descr:" ",ZCsgCardAttrib2Descr:" "};this.getView().getModel("oMaraTempModel").setData(t);this.getView().getModel("oMaraTempModel").refresh();var i=this.getOwnerComponent().getRouter();i.getRoute("grading").attachMatched(this._onRouteMatched,this);this._oGlobalFilter=null;this._oPriceFilter=null},_onRouteMatched:function(e){this.getView().byId("idMsdGradTab").setText("Missed Grading");this.getView().byId("idSportsCard").setValue(" ");this.getView().byId("idInputManuf").setValue(" ");this.getView().byId("idSetCode").setValue(" ");this.getView().byId("idPlayer").setValue(" ");this.getView().byId("idSubset").setValue(" ");this.getView().byId("idInputCardNo").setValue(" ");this.getView().byId("idInputNota").setValue(" ");this.getView().byId("idInputPedig").setValue(" ");this.getView().byId("idInputCollId").setValue(" ");this.getView().byId("idBump").setSelectedKey("");this.getView().byId("idInputYear").setValue(" ");this.getView().byId("idInputAttr1").setValue(" ");this.getView().byId("idInputAttr2").setValue(" ");this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idFinish").setSelected(false);this.getView().byId("idCrossOver").setValue(" ");var t={selected:""};var i=new sap.ui.model.json.JSONModel(t);this.getView().setModel(i,"oGradselModel");this.SalesId=e.getParameters().arguments.SalesId;this.LineId=e.getParameters().arguments.LineId;this.getView().byId("idGradSales").setText(this.SalesId);this.getView().byId("idGradLine").setText(this.LineId);var s=new sap.ui.model.json.JSONModel;this.getView().setModel(s,"MaraDataModel");var r=new sap.ui.model.json.JSONModel;this.getView().setModel(r,"GradHistModel");var a=new sap.ui.model.json.JSONModel;this.getView().setModel(a,"CollectibleModel");var l=new sap.ui.model.json.JSONModel;this.getView().setModel(l,"InitModel");var o=new sap.ui.model.json.JSONModel;var n=this.getOwnerComponent().getModel();this.oModel=this.getOwnerComponent().getModel();var g=new sap.ui.model.json.JSONModel;this.getView().setModel(g,"YearModel");var u=new sap.ui.model.json.JSONModel;this.getView().setModel(u,"ImageModel");var h=new sap.ui.model.json.JSONModel;this.getView().setModel(h,"pInitModel");var b=new sap.ui.model.json.JSONModel;this.getView().setModel(b,"SportsCardModel");var c=new sap.ui.model.json.JSONModel;this.getView().setModel(c,"CornerModel");var I=new sap.ui.model.json.JSONModel;this.getView().setModel(I,"CenterModel");var V=new sap.ui.model.json.JSONModel;this.getView().setModel(V,"AutoGradeModel");var w=new sap.ui.model.json.JSONModel;this.getView().setModel(w,"BumpModel");var y=new sap.ui.model.json.JSONModel;this.getView().setModel(y,"EdgeModel");var f=new sap.ui.model.json.JSONModel;this.getView().setModel(f,"GradeModel");var S=new sap.ui.model.json.JSONModel;this.getView().setModel(S,"NoGradeModel");var p=new sap.ui.model.json.JSONModel;this.getView().setModel(p,"SurfaceModel");var C=new sap.ui.model.json.JSONModel;this.getView().setModel(C,"SetCodeModel");C.setSizeLimit(600);var M=new sap.ui.model.json.JSONModel;this.getView().setModel(M,"SubsetModel");M.setSizeLimit(1e3);var E=new sap.ui.model.json.JSONModel;this.getView().setModel(E,"MakerModel");E.setSizeLimit(1e3);var m=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.LineId)];sap.ui.core.BusyIndicator.show();n.read("/Grade_SportscardSet",{success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("SportsCardModel").setData(e.results);this.getView().getModel("SportsCardModel").refresh()}.bind(this),error:function(){d.show("SportsCard Data not loaded, Please Contact Technical Team")}});n.read("/Grade_CenteringSet",{filters:m,success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("CenterModel").setData(e.results);this.getView().getModel("CenterModel").refresh()}.bind(this),error:function(){}});n.read("/Grade_autogradeSet",{filters:m,success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("AutoGradeModel").setData(e.results);this.getView().getModel("AutoGradeModel").refresh()}.bind(this),error:function(){}});n.read("/Grade_bumpSet",{filters:m,success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("BumpModel").setData(e.results);this.getView().getModel("BumpModel").refresh()}.bind(this),error:function(){}});n.read("/Grade_edgeSet",{filters:m,success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("EdgeModel").setData(e.results);this.getView().getModel("EdgeModel").refresh()}.bind(this),error:function(){}});var v=[new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"Y")];n.read("/Grade_gradeSet",{success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("GradeModel").setData(e.results);this.getView().getModel("GradeModel").refresh()}.bind(this),error:function(){}});n.read("/Grade_nogradeSet",{filters:m,success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("NoGradeModel").setData(e.results);this.getView().getModel("NoGradeModel").refresh()}.bind(this),error:function(){}});n.read("/Grade_surfaceSet",{filters:m,success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("SurfaceModel").setData(e.results);this.getView().getModel("SurfaceModel").refresh()}.bind(this),error:function(){}});n.read("/Grade_MakerSet",{filters:m,success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("MakerModel").setData(e.results);this.getView().getModel("MakerModel").refresh()}.bind(this),error:function(){}});n.read("/ZmmSubsetsrchSet",{success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("SubsetModel").setData(e.results);this.getView().getModel("SubsetModel").refresh()}.bind(this),error:function(){}});n.read("/Grade_cornerSet",{filters:m,success:function(e,t){o.setData(e);e.results.unshift(" ");this.getView().getModel("CornerModel").setData(e.results);this.getView().getModel("CornerModel").refresh()}.bind(this),error:function(){}});n.read("/Grade_MARADATASet",{filters:m,success:function(e,t){o.setData(e);if(e.results.length!==0){this.Certid=e.results[0].CertificateNo;this.Collid=e.results[0].CollectibleId;if(e.results[0].ZThickHolderFlag==="X"){this.getView().byId("idTH").setSelected(true)}else{this.getView().byId("idTH").setSelected(false)}if(e.results[0].FactoryAutograph==="X"){this.getView().byId("idInputAuto").setSelected(true)}else{this.getView().byId("idInputAuto").setSelected(false)}this.VcScCrossover=" ";this.VcScCrossover=e.results[0].VcScCrossover;if(e.results[0].VcScCrossover===" "){this.getView().byId("idCrossOver").setVisible(false);this.getView().byId("idCrossOverl").setVisible(false)}else{this.getView().byId("idCrossOver").setVisible(true);this.getView().byId("idCrossOverl").setVisible(true);this.getView().byId("idCrossOver").setEditable(false)}}this.getView().getModel("MaraDataModel").setData(e.results[0]);this.getView().getModel("MaraDataModel").refresh();var i=[new sap.ui.model.Filter("CertType",sap.ui.model.FilterOperator.EQ,"sportsCards"),new sap.ui.model.Filter("CertId",sap.ui.model.FilterOperator.EQ,this.Certid)];var s=this;n.read("/Image_displaySet",{filters:i,success:function(e,t){o.setData(e);if(e.results[0].FrontUrl!=="proxy not triggered"&&e.results[0].FrontUrl!==" "){this.getView().byId("idFrontUrl").setSrc(e.results[0].FrontUrl);this.getView().byId("idBackUrl").setSrc(e.results[0].BackUrl)}else{s.getView().byId("idFrontUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png");s.getView().byId("idBackUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png")}}.bind(this),error:function(){s.getView().byId("idFrontUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png");s.getView().byId("idBackUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png")}})}.bind(this),error:function(){d.show("Error in Loading Material Master Data, Please Contact Technical Team")}});n.read("/Grade_gradehistorySet",{filters:m,success:function(e,t){o.setData(e);if(e.results.length!==0){if(e.results[0].Perfect10==="X"){this.getView().byId("idPerChk").setSelected(true);this.getView().byId("idPristineChk").setSelected(false);this.perfectchk="S"}else if(e.results[0].Pristine10==="X"){this.getView().byId("idPristineChk").setSelected(true);this.getView().byId("idPerChk").setSelected(false)}else{this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setSelected(false)}if(e.results[0].GradeComplete==="X"){this.getView().byId("idFinish").setSelected(true);this.getView().byId("idExit").setEnabled(false);this.getView().byId("idPrevious").setEnabled(false);this.getView().byId("idNext").setEnabled(false);this.getView().byId("idInputCollId").setEnabled(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false);this.getView().byId("idNoGrade").setEnabled(false);this.getView().byId("idBump").setEnabled(false);this.getView().byId("idPerChk").setEnabled(false);d.show("Grading is Completed for this Salesorder and No further changes can be done")}else{this.getView().byId("idFinish").setSelected(false);this.getView().byId("idExit").setEnabled(true);this.getView().byId("idPrevious").setEnabled(true);this.getView().byId("idNext").setEnabled(true);this.getView().byId("idInputCollId").setEnabled(true);this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idNoGrade").setEnabled(true);this.getView().byId("idBump").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true)}if(e.results[0].Nograde!==""){this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false);this.getView().byId("idPerChk").setEnabled(false)}if(e.results[0].Nograde===""){this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true)}}else{this.getView().byId("idFinish").setSelected(false);this.getView().byId("idExit").setEnabled(true);this.getView().byId("idPrevious").setEnabled(true);this.getView().byId("idNext").setEnabled(true);this.getView().byId("idInputCollId").setEnabled(true);this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idNoGrade").setEnabled(true);this.getView().byId("idBump").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true)}this.getView().getModel("GradHistModel").setData(e.results);this.getView().getModel("GradHistModel").refresh()}.bind(this),error:function(){d.show("Error in Loading Grading History Data, Please Contact Technical Team")}});n.read("/getYearDropdownSet",{success:function(e,t){o.setData(e);this.getView().getModel("YearModel").setData(e.results);this.getView().getModel("YearModel").refresh()}.bind(this),error:function(){}});var G=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"M")];n.read("/getInitialLineItemsSet",{filters:G,success:function(e,t){o.setData(e);if(e.results.length!==0){var i=e.results[0].ExCount;var s=e.results.length;var d="Missed Gradings";var r=d.concat("(",i,"/",s,")");this.getView().byId("idMsdGradTab").setText(r)}this.getView().getModel("InitModel").setData(e.results);this.getView().getModel("InitModel").refresh();sap.ui.core.BusyIndicator.hide()}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide()}});var P=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"P")];n.read("/getInitialLineItemsSet",{filters:P,success:function(e,t){o.setData(e);this.getView().getModel("pInitModel").setData(e.results);this.getView().getModel("pInitModel").refresh()}.bind(this),error:function(){}});sap.ui.core.BusyIndicator.hide()},onExitCust:function(e){var t=this;t.onSave();this.getView().byId("idSportsCard").setValue(" ");this.getView().byId("idInputManuf").setValue(" ");this.getView().byId("idSetCode").setValue(" ");this.getView().byId("idPlayer").setValue(" ");this.getView().byId("idSubset").setValue(" ");this.getView().byId("idInputCardNo").setValue(" ");this.getView().byId("idInputNota").setValue(" ");this.getView().byId("idInputPedig").setValue(" ");this.getView().byId("idInputCollId").setValue(" ");this.getView().byId("idBump").setSelectedKey("");this.getView().byId("idInputYear").setValue(" ");this.getView().byId("idInputAttr1").setValue(" ");this.getView().byId("idInputAttr2").setValue(" ");this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idFinish").setSelected(false);this.getView().byId("idCrossOver").setValue(" ");this.getView().getModel("InitModel").refresh();var i=this.getOwnerComponent().getRouter();i.navTo("initial")},onInitrefresh:function(e){},onCancel:function(e){this.getView().byId("idSportsCard").setValue(" ");this.getView().byId("idInputManuf").setValue(" ");this.getView().byId("idSetCode").setValue(" ");this.getView().byId("idPlayer").setValue(" ");this.getView().byId("idSubset").setValue(" ");this.getView().byId("idInputCardNo").setValue(" ");this.getView().byId("idInputNota").setValue(" ");this.getView().byId("idInputPedig").setValue(" ");this.getView().byId("idInputCollId").setValue(" ");this.getView().byId("idBump").setSelectedKey("");this.getView().byId("idInputYear").setValue(" ");this.getView().byId("idInputAttr1").setValue(" ");this.getView().byId("idInputAttr2").setValue(" ");this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idFinish").setSelected(false);this.getView().byId("idCrossOver").setValue(" ");this.getView().getModel("MaraDataModel").refresh();this.getView().getModel("GradHistModel").refresh();this.getView().getModel("CollectibleModel").refresh();this.getView().getModel("ImageModel").refresh();var t=this.getOwnerComponent().getRouter();t.navTo("initial")},onPrintLabel:function(e){var t=this.getView().byId("idInputCollId").getValue();if(t===""){r.error("Collectible ID is missing, cannot Print Preview")}if(t!==""){var i=new sap.m.BusyDialog({text:"Please wait.. PDF Preview is getting Generated"});i.open();this.LineId=this.getView().byId("idGradLine").getText();var s=this.getView().getModel().sServiceUrl;var d=s+"/FILE_PDFDISPLAYSet(Vbeln='"+this.SalesId+"',Posnr='"+this.LineId+"',Box='NO')/$value";i.close();window.open(d)}},onCloseDialogn:function(){this.byId("imgDialog").close();if(this._pDialog){var e=this._pDialog;e.close()}},handleUploadPress:function(e){},onNext:function(e){var t=this;var i=this.getView().byId("idAutoGrade").getSelectedKey();var s=this.getView().byId("idNoGrade").getSelectedKey();if(this.getView().byId("idInputAuto").getSelected()===true&&s===""){if(i===""){r.error("Autograph Grade is Mandatory")}else{t.onSave()}}else{t.onSave()}},onPrevious:function(e){var t=this;var i=this.getView().byId("idAutoGrade").getSelectedKey();var s=this.getView().byId("idNoGrade").getSelectedKey();if(this.getView().byId("idInputAuto").getSelected()===true&&s===" "){if(i===""){r.error("Autograph Grade is Mandatory")}else{t.onSavep()}}else{t.onSavep()}},onSave:function(e){var t;var i;var s;var r;var a;var l;var o;var n;var g;var u=this.getView().getModel("MaraDataModel").getData();if(this.getView().byId("idFinish").getSelected()===true){var h="X"}else{h="Y"}if(this.getView().byId("idPerChk").getSelected()===true||this.getView().byId("idPristineChk").getSelected()===true){if(this.getView().byId("idPerChk").getSelected()===true){i="10";s="10";r="10";a="10";t="10";n="X";g=""}else if(this.getView().byId("idPristineChk").getSelected()===true){t="10";g="X";n=""}l=this.getView().byId("idAutoGrade").getSelectedKey();o=this.getView().byId("idNoGrade").getSelectedKey()}else{n=" ";g="";t=this.getView().byId("idGrade").getSelectedKey();i=this.getView().byId("idCenter").getSelectedKey();s=this.getView().byId("idCorner").getSelectedKey();r=this.getView().byId("idEdge").getSelectedKey();a=this.getView().byId("idSurface").getSelectedKey();l=this.getView().byId("idAutoGrade").getSelectedKey();o=this.getView().byId("idNoGrade").getSelectedKey()}var b=this.getView().byId("idNoGrade").getSelectedKey();if(b!==""){t="";i="";s="";r="";a="";n="";g="";l=""}var c=[];var I={ImFlag:"S",Center:i,LvPosnr:u.LvPosnr,Corner:s,BizUnit:" ",LvVbeln:u.LvVbeln,Edge:r,ExPosnr:" ",Surface:a,ExVbeln:" ",Auto:l,SeqNo:1,Action:"Graded",Vbeln:u.LvVbeln,Posnr:u.LvPosnr,CollectibleId:u.CollectibleId,Grade:t,Guser:"",Gdate:"2022-06-27T00:00:00",FinalGrade:h,Nograde:o,Perfect10:n,Pristine10:g,Pedigree:u.Pedigree,InternalNote:u.InternalNote,Notation:u.Notation};c.push(I);sap.ui.core.BusyIndicator.show();var V=this;var w=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZODATA_CHARACTERISTCS_GRADEAPP_SRV/");w.create("/Grade_gradehistorySet",I,{method:"POST",success:function(e){V.onGetGradeHistcall();d.show("Grading Data Saved Succesfully")},error:function(e){sap.ui.core.BusyIndicator.hide()}});if(this.getView().byId("idPerChk").getSelected()===true||this.getView().byId("idPristineChk").getSelected()===true){if(this.getView().byId("idPerChk").getSelected()===true){t="10";i="10";s="10";r="10";a="10";n="X"}else if(this.getView().byId("idPristineChk").getSelected()===true){t="10";i="";s="";r="";a="";n="";g="X"}l=this.getView().byId("idAutoGrade").getSelectedKey();o=this.getView().byId("idNoGrade").getSelectedKey()}else{n=" ";t=this.getView().byId("idGrade").getSelectedKey();i=this.getView().byId("idCenter").getSelectedKey();s=this.getView().byId("idCorner").getSelectedKey();r=this.getView().byId("idEdge").getSelectedKey();a=this.getView().byId("idSurface").getSelectedKey();l=this.getView().byId("idAutoGrade").getSelectedKey();o=this.getView().byId("idNoGrade").getSelectedKey()}b=this.getView().byId("idNoGrade").getSelectedKey();if(b!==""){t="";i="";s="";r="";a="";n="";l=""}var y=this.getView().byId("idBump").getSelectedKey();var f=[];var S={ImFlag:"S",Centering:i,ZThickHolderFlag:" ",Perfect10:n,LvPosnr:u.LvPosnr,Corner:s,LvVbeln:u.LvVbeln,Edge:r,ExPosnr:u.LvPosnr,Surface:a,ExVbeln:u.LvVbeln,AutoGrade:l,Matnr:"",Grade:t,ZCardYear:u.ZCardYear,NoGrade:o,ZCsgSportsCode:u.ZCsgSportsCode,ZCsgMakerCode:u.ZCsgMakerCode,ZCsgSetCode:u.ZCsgSetCode,ZCsgSubsetCode:u.ZCsgSubsetCode,ZCsgSportPlayerCode:" ",ZCardNumber:u.ZCardNumber,ZCsgCardAttribute1Code:u.ZCsgCardAttribute1Code,ZCsgCardAttribute2Code:u.ZCsgCardAttribute2Code,ZCsgCardAttrib1Descr:u.ZCsgCardAttrib1Descr,ZCsgCardAttrib2Descr:u.ZCsgCardAttrib2Descr,ZTeamDescription:u.ZTeamDescription,ZDateFreetext:u.ZDateFreetext,Notation:u.Notation,Pedigree:u.Pedigree,FactoryAutograph:u.FactoryAutograph,Bump:y,InternalNote:u.InternalNote,CollectibleId:u.CollectibleId,ZSubjectDescription:u.ZSubjectDescription,CertificateNo:u.CertificateNo,VcScCrossover:u.VcScCrossover,VcScServices:u.VcScServices,VcScAddOn:u.VcScAddOn,VcScCrossoverCo:u.VcScCrossoverCo,VcScCrossoverGr:u.VcScCrossoverGr,VcTradeshow:u.VcTradeshow,ScAiSubgradeCentre:u.ScAiSubgradeCentre,ScAiSubgradeCorner:u.ScAiSubgradeCorner,ScAiSubgradeEdge:u.ScAiSubgradeEdge,ScAiSubgradeSurface:u.ScAiSubgradeSurface,ScAiSubgradeAuto:u.ScAiSubgradeAuto};f.push(S);var p=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZODATA_CHARACTERISTCS_GRADEAPP_SRV/");var V=this;p.create("/Grade_MARADATASet",S,{method:"POST",success:function(e){V.onGetMaraDatacall();V.onMissedCall();var t=e.MESSAGE;d.show("Data Saved Succesfully")},error:function(e){sap.ui.core.BusyIndicator.hide();d.show("Failed to save Data")}})},onSavep:function(e){var t;var i;var s;var r;var a;var l;var o;var n;var g;var u=this.getView().getModel("MaraDataModel").getData();if(this.getView().byId("idFinish").getSelected()==true){var h="X"}else{h="Y"}if(this.getView().byId("idPerChk").getSelected()===true||this.getView().byId("idPristineChk").getSelected()===true){if(this.getView().byId("idPerChk").getSelected()===true){t="10";i="10";s="10";r="10";a="10";n="X";g=""}else if(this.getView().byId("idPristineChk").getSelected()===true){t="10";i="";s="";r="";a="";g="X";n=""}l=this.getView().byId("idAutoGrade").getSelectedKey();o=this.getView().byId("idNoGrade").getSelectedKey()}else{n=" ";g="";t=this.getView().byId("idGrade").getSelectedKey();i=this.getView().byId("idCenter").getSelectedKey();s=this.getView().byId("idCorner").getSelectedKey();r=this.getView().byId("idEdge").getSelectedKey();a=this.getView().byId("idSurface").getSelectedKey();l=this.getView().byId("idAutoGrade").getSelectedKey();o=this.getView().byId("idNoGrade").getSelectedKey()}var b=this.getView().byId("idNoGrade").getSelectedKey();if(b!==""){t="";i="";s="";r="";a="";n="";g="";l=""}var c=[];var I={ImFlag:"S",Center:i,LvPosnr:u.LvPosnr,Corner:s,BizUnit:" ",LvVbeln:u.LvVbeln,Edge:r,ExPosnr:" ",Surface:a,ExVbeln:" ",Auto:l,SeqNo:1,Action:"Graded",Vbeln:u.LvVbeln,Posnr:u.LvPosnr,CollectibleId:u.CollectibleId,Grade:t,Guser:"",Gdate:"2022-06-27T00:00:00",FinalGrade:h,Nograde:o,Perfect10:n,Pristine10:g,Pedigree:u.Pedigree,InternalNote:u.InternalNote,Notation:u.Notation};c.push(I);sap.ui.core.BusyIndicator.show();var V=this;var w=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZODATA_CHARACTERISTCS_GRADEAPP_SRV/");w.create("/Grade_gradehistorySet",I,{method:"POST",success:function(e){V.onGetGradeHistcallp();var t=e.MESSAGE;d.show("Grading Data Saved Succesfully")},error:function(e){sap.ui.core.BusyIndicator.hide()}});if(this.getView().byId("idPerChk").getSelected()==true){t="10";i="10";s="10";r="10";a="10";n="X";l=this.getView().byId("idAutoGrade").getSelectedKey();o=this.getView().byId("idNoGrade").getSelectedKey()}else{n=" ";t=this.getView().byId("idGrade").getSelectedKey();i=this.getView().byId("idCenter").getSelectedKey();s=this.getView().byId("idCorner").getSelectedKey();r=this.getView().byId("idEdge").getSelectedKey();a=this.getView().byId("idSurface").getSelectedKey();l=this.getView().byId("idAutoGrade").getSelectedKey();o=this.getView().byId("idNoGrade").getSelectedKey()}var b=this.getView().byId("idNoGrade").getSelectedKey();if(b!==""){t="";i="";s="";r="";a="";n="";l=""}var y=this.getView().byId("idBump").getSelectedKey();var f=[];var S={ImFlag:"S",Centering:i,ZThickHolderFlag:" ",Perfect10:n,LvPosnr:u.LvPosnr,Corner:s,LvVbeln:u.LvVbeln,Edge:r,ExPosnr:u.LvPosnr,Surface:a,ExVbeln:u.LvVbeln,AutoGrade:l,Matnr:"",Grade:t,ZCardYear:u.ZCardYear,NoGrade:o,ZCsgSportsCode:u.ZCsgSportsCode,ZCsgMakerCode:u.ZCsgMakerCode,ZCsgSetCode:u.ZCsgSetCode,ZCsgSubsetCode:" ",ZCsgSportPlayerCode:" ",ZCardNumber:u.ZCardNumber,ZCsgCardAttribute1Code:u.ZCsgCardAttribute1Code,ZCsgCardAttribute2Code:u.ZCsgCardAttribute2Code,ZCsgCardAttrib1Descr:u.ZCsgCardAttrib1Descr,ZCsgCardAttrib2Descr:u.ZCsgCardAttrib2Descr,Notation:u.Notation,Pedigree:u.Pedigree,FactoryAutograph:u.FactoryAutograph,Bump:y,InternalNote:u.InternalNote,CollectibleId:u.CollectibleId,ZSubjectDescription:u.ZSubjectDescription,CertificateNo:u.CertificateNo,VcScCrossover:u.VcScCrossover,VcScServices:u.VcScServices,VcScAddOn:u.VcScAddOn,VcScCrossoverCo:u.VcScCrossoverCo,VcScCrossoverGr:u.VcScCrossoverGr,VcTradeshow:u.VcTradeshow,ScAiSubgradeCentre:u.ScAiSubgradeCentre,ScAiSubgradeCorner:u.ScAiSubgradeCorner,ScAiSubgradeEdge:u.ScAiSubgradeEdge,ScAiSubgradeSurface:u.ScAiSubgradeSurface,ScAiSubgradeAuto:u.ScAiSubgradeAuto};f.push(S);var p=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZODATA_CHARACTERISTCS_GRADEAPP_SRV/");var V=this;p.create("/Grade_MARADATASet",S,{method:"POST",success:function(e){V.onGetMaraDatacallp();V.onMissedCall();var t=e.MESSAGE;d.show("Data Saved Succesfully")},error:function(e){}})},onGetMaraDatacallp:function(e){this.LineId=this.getView().byId("idGradLine").getText();var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();var s=this.getOwnerComponent().getModel();var d=this.getView().getModel("pInitModel").getData();var a=" ";if(this.LineId==d[0].Posnr){a="X";r.information("No Previous Lineitems to Grade")}if(a!=="X"){this.getView().byId("idSportsCard").setValue(" ");this.getView().byId("idInputManuf").setValue(" ");this.getView().byId("idSetCode").setValue(" ");this.getView().byId("idPlayer").setValue(" ");this.getView().byId("idSubset").setValue(" ");this.getView().byId("idInputCardNo").setValue(" ");this.getView().byId("idInputNota").setValue(" ");this.getView().byId("idInputPedig").setValue(" ");this.getView().byId("idInputCollId").setValue(" ");this.getView().byId("idBump").setSelectedKey("");this.getView().byId("idInputYear").setValue(" ");this.getView().byId("idInputAttr1").setValue(" ");this.getView().byId("idInputAttr2").setValue(" ");this.getView().byId("idCrossOver").setValue(" ");this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idNoGrade").setEnabled(true)}this.LineId=this.getView().byId("idGradLine").getText();var l=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"P")];i.read("/Grade_MARADATASet",{filters:l,success:function(e,i){t.setData(e);if(e.results.length!==0){this.Collid=e.results[0].CollectibleId;this.VcScCrossover=" ";this.VcScCrossover=e.results[0].VcScCrossover;this.getImageDataP(e.results[0].CertificateNo);this.Certid=e.results[0].CertificateNo}if(e.results.length!==0){if(e.results[0].ZThickHolderFlag==="X"){this.getView().byId("idTH").setSelected(true)}else{this.getView().byId("idTH").setSelected(false)}if(e.results[0].FactoryAutograph==="X"){this.getView().byId("idInputAuto").setSelected(true)}else{this.getView().byId("idInputAuto").setSelected(false)}if(e.results[0].NoGrade!==""){this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false);this.getView().byId("idPerChk").setEnabled(false)}if(e.results[0].NoGrade===""){this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true)}}this.getView().getModel("MaraDataModel").setData(e.results[0]);this.getView().getModel("MaraDataModel").refresh()}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide()}})},getImageDataP:function(e){var t=new sap.ui.model.json.JSONModel;var i=[new sap.ui.model.Filter("CertType",sap.ui.model.FilterOperator.EQ,"sportsCards"),new sap.ui.model.Filter("CertId",sap.ui.model.FilterOperator.EQ,e)];var s=this;this.oModel.read("/Image_displaySet",{filters:i,success:function(e,i){sap.ui.core.BusyIndicator.hide();t.setData(e);if(e.results[0].FrontUrl!=="proxy not triggered"){this.getView().byId("idFrontUrl").setSrc(e.results[0].FrontUrl);this.getView().byId("idBackUrl").setSrc(e.results[0].BackUrl)}else{s.getView().byId("idFrontUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png");s.getView().byId("idBackUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png")}}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide();s.getView().byId("idFrontUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png");s.getView().byId("idBackUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png")}})},onGetMaraDatacall:function(e){this.LineId=this.getView().byId("idGradLine").getText();var t=this.getView().getModel("pInitModel").getData();var i=new sap.ui.model.json.JSONModel;var s=this.getOwnerComponent().getModel();var d=this.getOwnerComponent().getModel();var a=" ";if(this.getView().byId("idFinish").getSelected()===true){a="X"}if(this.getView().byId("idFinish").getSelected()!==true){for(var l=0;l<t.length;l++){if(l==t.length-1){var o=t[l];if(this.LineId==o.Posnr){a="X";r.information("No further Lineitems to Grade")}}}}if(a!=="X"){this.getView().byId("idSportsCard").setValue(" ");this.getView().byId("idInputManuf").setValue(" ");this.getView().byId("idSetCode").setValue(" ");this.getView().byId("idPlayer").setValue(" ");this.getView().byId("idSubset").setValue(" ");this.getView().byId("idInputCardNo").setValue(" ");this.getView().byId("idInputNota").setValue(" ");this.getView().byId("idInputPedig").setValue(" ");this.getView().byId("idInputCollId").setValue(" ");this.getView().byId("idBump").setSelectedKey("");this.getView().byId("idInputYear").setValue(" ");this.getView().byId("idInputAttr1").setValue(" ");this.getView().byId("idInputAttr2").setValue(" ");this.getView().byId("idCrossOver").setValue(" ");this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idNoGrade").setEnabled(true)}this.LineId=this.getView().byId("idGradLine").getText();var n=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"N")];s.read("/Grade_MARADATASet",{filters:n,success:function(e,t){i.setData(e);if(e.results.length!==0){this.Collid=e.results[0].CollectibleId;this.VcScCrossover=" ";this.VcScCrossover=e.results[0].VcScCrossover;this.getImageNext(e.results[0].CertificateNo);this.Certid=e.results[0].CertificateNo}if(e.results.length!==0){if(e.results[0].ZThickHolderFlag==="X"){this.getView().byId("idTH").setSelected(true)}else{this.getView().byId("idTH").setSelected(false)}if(e.results[0].FactoryAutograph==="X"){this.getView().byId("idInputAuto").setSelected(true)}else{this.getView().byId("idInputAuto").setSelected(false)}if(e.results[0].NoGrade!==""){this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false)}if(e.results[0].NoGrade===""){this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true)}}this.getView().getModel("MaraDataModel").setData(e.results[0]);this.getView().getModel("MaraDataModel").refresh()}.bind(this),error:function(){}})},getImageNext:function(e){var t=new sap.ui.model.json.JSONModel;var i=[new sap.ui.model.Filter("CertType",sap.ui.model.FilterOperator.EQ,"sportsCards"),new sap.ui.model.Filter("CertId",sap.ui.model.FilterOperator.EQ,e)];var s=this;this.oModel.read("/Image_displaySet",{filters:i,success:function(e,i){sap.ui.core.BusyIndicator.hide();t.setData(e);if(e.results[0].FrontUrl!=="proxy not triggered"){this.getView().byId("idFrontUrl").setSrc(e.results[0].FrontUrl);this.getView().byId("idBackUrl").setSrc(e.results[0].BackUrl)}else{s.getView().byId("idFrontUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png");s.getView().byId("idBackUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png")}}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide();s.getView().byId("idFrontUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png");s.getView().byId("idBackUrl").setSrc("/sap/bc/ui5_ui5/sap/ZSD_GRADINGAPP/Image/No_image.png")}})},onGetGradeHistcallp:function(e){var t=new sap.ui.model.json.JSONModel;var i=new sap.ui.model.json.JSONModel;var s=this.getOwnerComponent().getModel();var r=this.getOwnerComponent().getModel();this.LineId=this.getView().byId("idGradLine").getText();var a=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"P")];r.read("/Grade_gradehistorySet",{filters:a,success:function(e,t){i.setData(e);if(e.results.length!==0){if(e.results[0].Perfect10==="X"){this.perfectchk="S";this.getView().byId("idPerChk").setSelected(true);this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idPerChk").setEnabled(true)}else if(e.results[0].Pristine10==="X"){this.getView().byId("idPristineChk").setSelected(true);this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setEnabled(true)}else{this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idPerChk").setEnabled(true);this.getView().byId("idPristineChk").setEnabled(true)}if(e.results[0].GradeComplete==="X"){this.getView().byId("idFinish").setSelected(true);this.getView().byId("idExit").setEnabled(false);this.getView().byId("idPrevious").setEnabled(false);this.getView().byId("idNext").setEnabled(false);this.getView().byId("idInputCollId").setEnabled(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false);this.getView().byId("idNoGrade").setEnabled(false);this.getView().byId("idBump").setEnabled(false);this.getView().byId("idPerChk").setEnabled(false);d.show("Grading is Completed for this Salesorder and No further changes can be done")}else{this.getView().byId("idFinish").setSelected(false);this.getView().byId("idExit").setEnabled(true);this.getView().byId("idPrevious").setEnabled(true);this.getView().byId("idNext").setEnabled(true);this.getView().byId("idInputCollId").setEnabled(true);this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idNoGrade").setEnabled(true);this.getView().byId("idBump").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true)}if(e.results[0].Nograde!==""){this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false);this.getView().byId("idPerChk").setEnabled(false)}else{this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true)}}else{this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idPerChk").setEnabled(true);this.getView().byId("idPristineChk").setEnabled(true)}this.getView().getModel("GradHistModel").setData(e.results);this.getView().getModel("GradHistModel").refresh()}.bind(this),error:function(){}});this.getView().byId("idPerChk").setSelected(false)},onGetGradeHistcall:function(e){var t=new sap.ui.model.json.JSONModel;var i=new sap.ui.model.json.JSONModel;var s=this.getOwnerComponent().getModel();var r=this.getOwnerComponent().getModel();this.LineId=this.getView().byId("idGradLine").getText();var a=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"N")];r.read("/Grade_gradehistorySet",{filters:a,success:function(e,t){i.setData(e);if(e.results.length!==0){if(e.results[0].Perfect10==="X"){this.perfectchk="S";this.getView().byId("idPerChk").setSelected(true);this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idPerChk").setEnabled(true)}else if(e.results[0].Pristine10==="X"){this.getView().byId("idPristineChk").setSelected(true);this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setEnabled(true)}else{this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idPerChk").setEnabled(true);this.getView().byId("idPristineChk").setEnabled(true)}if(e.results[0].GradeComplete==="X"){this.getView().byId("idFinish").setSelected(true);this.getView().byId("idExit").setEnabled(false);this.getView().byId("idPrevious").setEnabled(false);this.getView().byId("idNext").setEnabled(false);this.getView().byId("idInputCollId").setEnabled(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false);this.getView().byId("idNoGrade").setEnabled(false);this.getView().byId("idBump").setEnabled(false);this.getView().byId("idPerChk").setEnabled(false);d.show("Grading is Completed for this Salesorder and No further changes can be done")}else{this.getView().byId("idFinish").setSelected(false);this.getView().byId("idExit").setEnabled(true);this.getView().byId("idPrevious").setEnabled(true);this.getView().byId("idNext").setEnabled(true);this.getView().byId("idInputCollId").setEnabled(true);this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idNoGrade").setEnabled(true);this.getView().byId("idBump").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true)}if(e.results[0].Nograde!==""){this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false);this.getView().byId("idPerChk").setEnabled(false)}else{this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true)}}else{this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idPerChk").setEnabled(true);this.getView().byId("idPristineChk").setEnabled(true)}this.getView().getModel("GradHistModel").setData(e.results);this.getView().getModel("GradHistModel").refresh()}.bind(this),error:function(){}});this.getView().byId("idPerChk").setSelected(false)},onMissedCall:function(e){var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();var s=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"M")];i.read("/getInitialLineItemsSet",{filters:s,success:function(e,i){t.setData(e);if(e.results.length!==0){var s=e.results[0].ExCount;var d=e.results.length;var r="Missed Gradings";var a=r.concat("(",s,"/",d,")");this.getView().byId("idMsdGradTab").setText(a)}this.getView().byId("idMsdGradTab").setText(a);this.getView().getModel("InitModel").setData(e.results);this.getView().getModel("InitModel").refresh();sap.ui.core.BusyIndicator.hide()}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide()}})},onPristineSelect:function(e){if(this.getView().byId("idPristineChk").getSelected()==true){this.getView().byId("idGrade").setValue("Pristine 10");this.getView().byId("idGrade").setSelectedKey("10");this.getView().byId("idPerChk").setSelected(false)}else{this.getView().byId("idGrade").setValue("");this.getView().byId("idGrade").setSelectedKey("")}},onPerSelect:function(e){if(this.getView().byId("idPerChk").getSelected()==true){var t=new sap.ui.model.json.JSONModel;t={kgrade:this.getView().byId("idGrade").getSelectedKey(),kcenter:this.getView().byId("idCenter").getSelectedKey(),kcorner:this.getView().byId("idCorner").getSelectedKey(),kedge:this.getView().byId("idEdge").getSelectedKey(),ksurface:this.getView().byId("idSurface").getSelectedKey(),lgrade:this.getView().byId("idGrade").getValue(),lcenter:this.getView().byId("idCenter").getValue(),lcorner:this.getView().byId("idCorner").getValue(),ledge:this.getView().byId("idEdge").getValue(),lsurface:this.getView().byId("idSurface").getValue()};this.getView().setModel(t,"DataModel");this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idCenter").setValue("Gem Mint 10");this.getView().byId("idCorner").setValue("Gem Mint 10");this.getView().byId("idEdge").setValue("Gem Mint 10");this.getView().byId("idSurface").setValue("Gem Mint 10");this.getView().byId("idGrade").setValue("10");this.getView().byId("idCenter").setSelectedKey("10");this.getView().byId("idCorner").setSelectedKey("10");this.getView().byId("idEdge").setSelectedKey("10");this.getView().byId("idSurface").setSelectedKey("10");this.getView().byId("idGrade").setSelectedKey("10")}if(this.getView().byId("idPerChk").getSelected()===false){if(this.perfectchk!=="S"){var i=this.getView().getModel("DataModel").lgrade;var s=this.getView().getModel("DataModel").lcenter;var d=this.getView().getModel("DataModel").lcorner;var r=this.getView().getModel("DataModel").ledge;var a=this.getView().getModel("DataModel").lsurface;var l=this.getView().getModel("DataModel").kgrade;var o=this.getView().getModel("DataModel").kcenter;var n=this.getView().getModel("DataModel").kcorner;var g=this.getView().getModel("DataModel").kedge;var u=this.getView().getModel("DataModel").ksurface}this.perfectchk=" ";this.getView().byId("idCenter").setValue(s);this.getView().byId("idCorner").setValue(d);this.getView().byId("idEdge").setValue(r);this.getView().byId("idSurface").setValue(a);this.getView().byId("idGrade").setValue(i);this.getView().byId("idCenter").setSelectedKey(o);this.getView().byId("idCorner").setSelectedKey(n);this.getView().byId("idEdge").setSelectedKey(g);this.getView().byId("idSurface").setSelectedKey(u);this.getView().byId("idGrade").setSelectedKey(l)}},onValueHelpRequested:function(){sap.ui.core.BusyIndicator.show();var e=new sap.ui.model.json.JSONModel;var t=this.getOwnerComponent().getModel();t.read("/Grade_setcodeSet",{success:function(t,i){e.setData(t);t.results.unshift(" ");this.getView().getModel("SetCodeModel").setData(t.results);this.getView().getModel("SetCodeModel").refresh()}.bind(this),error:function(){}});t.read("/ZmmSearchHelpSet",{success:function(t,i){e.setData(t);sap.ui.core.BusyIndicator.hide();this.getView().getModel("CollectibleModel").setData(t.results);this.getView().getModel("CollectibleModel").refresh()}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide();d.show("Failed to Load Data")}});this.cDialog=a.load({name:"CCGSDGRADINGAPP.ZSD_GRADINGAPP.view.fragment.collectible",controller:this}).then(function(e){this.getView().addDependent(e);e.open()}.bind(this))},onValueHelpCancelPress:function(){this._oValueHelpDialog.close()},onValueHelpAfterClose:function(){this._oValueHelpDialog.destroy()},handleOkDlogPress:function(e){var t=sap.ui.getCore().byId("idGradeTablef");var i=t.getSelectedIndices();if(i.length==0){r.error("No Collectible Row is selected")}else{var s=this;s.onCloseDialog()}this.onValueHelpAfterClose()},handleRefreshPress:function(e){sap.ui.core.BusyIndicator.show();sap.ui.getCore().byId("idSportsCardf").setSelectedKey("");sap.ui.getCore().byId("idInputManuff").setSelectedKey("");sap.ui.getCore().byId("idSetCodef").setSelectedKey("");sap.ui.getCore().byId("idPlayerf").setValue(" ");sap.ui.getCore().byId("idMaterialf").setValue(" ");sap.ui.getCore().byId("idInputYearf").setValue(" ");sap.ui.getCore().byId("idInputAttr1f").setValue(" ");sap.ui.getCore().byId("idInputAttr2f").setValue(" ");var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();i.read("/ZmmSearchHelpSet",{success:function(e,i){t.setData(e);sap.ui.core.BusyIndicator.hide();this.getView().getModel("CollectibleModel").setData(e.results);this.getView().getModel("CollectibleModel").refresh()}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide();d.show("Error in Loading Data, Please Contact Technical Team")}})},handleGoDlogPress:function(e){var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();var s=sap.ui.getCore().byId("idSportsCardf").getSelectedKey();var r=sap.ui.getCore().byId("idInputManuff").getSelectedKey();var a=sap.ui.getCore().byId("idSetCodef").getSelectedKey();var l=sap.ui.getCore().byId("idInputYearf").getSelectedKey();var o=sap.ui.getCore().byId("idPlayerf")._lastValue;var n=sap.ui.getCore().byId("idMaterialf")._lastValue;var g=sap.ui.getCore().byId("idInputAttr1f")._lastValue;var u=sap.ui.getCore().byId("idInputAttr2f")._lastValue;if(n==" "&&s==" "&&r==" "&&a==" "&&l==" "&&o==" "&&g==" "&&u==" "){sap.ui.core.BusyIndicator.show();i.read("/ZmmSearchHelpSet",{success:function(e,i){t.setData(e);sap.ui.core.BusyIndicator.hide();this.getView().getModel("CollectibleModel").setData(e.results);this.getView().getModel("CollectibleModel").refresh()}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide();d.show("Failed to Load Data, Refresh Again")}})}else{var h=[new sap.ui.model.Filter("Matnr",sap.ui.model.FilterOperator.EQ,n),new sap.ui.model.Filter("ZSportscodeText",sap.ui.model.FilterOperator.EQ,s),new sap.ui.model.Filter("ZMakercodeText",sap.ui.model.FilterOperator.EQ,r),new sap.ui.model.Filter("ZCardsetText",sap.ui.model.FilterOperator.EQ,a),new sap.ui.model.Filter("ZCardYear",sap.ui.model.FilterOperator.EQ,l),new sap.ui.model.Filter("ZSubjectDescription",sap.ui.model.FilterOperator.EQ,o),new sap.ui.model.Filter("ZCsgCardAttrib1Descr",sap.ui.model.FilterOperator.EQ,g),new sap.ui.model.Filter("ZCsgCardAttrib2Descr",sap.ui.model.FilterOperator.EQ,u)];i.read("/ZmmSearchHelpSet",{filters:h,success:function(e,i){t.setData(e);this.getView().getModel("CollectibleModel").setData(e.results);this.getView().getModel("CollectibleModel").refresh()}.bind(this),error:function(){d.show("No Data for this Search")}})}this.onValueHelpAfterClose()},onCloseDialog:function(e){sap.ui.getCore().byId("idSportsCardf").setSelectedKey(" ");sap.ui.getCore().byId("idInputManuff").setSelectedKey(" ");sap.ui.getCore().byId("idSetCodef").setSelectedKey(" ");sap.ui.getCore().byId("idInputYearf").setValue(" ");sap.ui.getCore().byId("idPlayerf").setValue(" ");sap.ui.getCore().byId("idMaterialf").setValue(" ");sap.ui.getCore().byId("colDialog").destroy()},action:function(e){sap.ui.core.BusyIndicator.show();var t=e.getParameters().rowContext.getPath();var i=e.getParameters().rowContext.getModel("CollectibleModel").getProperty(t);var s=i.Matnr;var d=i.ZCsgSetCode;this.LineId=this.getView().byId("idGradLine").getText();this.CollectId=s;var r=new sap.ui.model.json.JSONModel;var a=this.getOwnerComponent().getModel();var l=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"C"),new sap.ui.model.Filter("ImCollectid",sap.ui.model.FilterOperator.EQ,this.CollectId)];var o=this.getView().byId("idBump").getSelectedKey();a.read("/Grade_MARADATASet",{filters:l,success:function(e,t){r.setData(e);if(e.results.length!==0){this.Collid=e.results[0].CollectibleId}e.results[0].Bump=o;if(e.results.length!==0){if(e.results[0].ZThickHolderFlag==="X"){this.getView().byId("idTH").setSelected(true)}else{this.getView().byId("idTH").setSelected(false)}if(e.results[0].FactoryAutograph==="X"){this.getView().byId("idInputAuto").setSelected(true)}else{this.getView().byId("idInputAuto").setSelected(false)}}this.getView().getModel("MaraDataModel").setData(e.results[0]);this.getView().getModel("MaraDataModel").refresh();sap.ui.core.BusyIndicator.hide()}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide()}});var n=new sap.ui.model.json.JSONModel;this.getView().setModel(n,"SubsetModel");n.setSizeLimit(3e3);var g=[new sap.ui.model.Filter("CsgCardSetCode",sap.ui.model.FilterOperator.EQ,d)];a.read("/ZmmSubsetsrchSet",{filters:g,success:function(e,t){r.setData(e);e.results.unshift(" ");this.getView().getModel("SubsetModel").setData(e.results);this.getView().getModel("SubsetModel").refresh()}.bind(this),error:function(){}})},onPrintBox:function(e){this.LineId=this.getView().byId("idGradLine").getText();var t=this.getView().getModel().sServiceUrl;var i=t+"/FILE_PDFDISPLAYSet(Vbeln='"+this.SalesId+"',Posnr='"+this.LineId+"',Box='YES')/$value";window.open(i)},onCollectEnter:function(e){this.CollectId=this.getView().byId("idInputCollId").getText();var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();var s=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"C"),new sap.ui.model.Filter("ImCollectid",sap.ui.model.FilterOperator.EQ,this.CollectId)];var d=this.getView().byId("idBump").getSelectedKey();i.read("/Grade_MARADATASet",{filters:s,success:function(e,i){t.setData(e);if(e.results.length!==0){this.Collid=e.results[0].CollectibleId}e.results[0].Bump=d;if(e.results.length!==0){if(e.results[0].ZThickHolderFlag==="X"){this.getView().byId("idTH").setSelected(true)}else{this.getView().byId("idTH").setSelected(false)}if(e.results[0].FactoryAutograph==="X"){this.getView().byId("idInputAuto").setSelected(true)}else{this.getView().byId("idInputAuto").setSelected(false)}}this.getView().getModel("MaraDataModel").setData(e.results[0]);this.getView().getModel("MaraDataModel").refresh()}.bind(this),error:function(){}})},handleActionPress:function(e){},OnGradeSel:function(e){var t=this.getView().byId("idGrade").getSelectedKey();var i=this.getView().byId("idNoGrade").getSelectedKey();if(this.VcScCrossover!=""){if(i==""){if(this.VcScCrossover>=t){var s="Grade should be more than Crossover ";var d=s.concat(this.VcScCrossover);r.information(d)}}}},OnGradeSelCng:function(e){var t=this.getView().byId("idGrade").getSelectedKey();var i=e.getParameter("selectedItem").getAdditionalText();if(t=="10"&&(i=="PRISTINE"||i=="Pristine")){this.getView().byId("idPristineChk").setSelected(true);this.getView().byId("idPerChk").setSelected(false)}else if(t=="10"&&(i=="PERFECT"||i=="Perfect")){this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idPerChk").setSelected(true)}else{this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idPerChk").setSelected(false)}},onGradCompleteSelect:function(e){var t=this;if(this.getView().byId("idFinish").getSelected()===false){r.warning("You are Revoking the Grade Completion status, Click OK & Save to continue",{actions:[r.Action.OK,r.Action.CANCEL],emphasizedAction:r.Action.OK,onClose:function(e){if(e==="OK"){var i=new sap.ui.model.json.JSONModel;var s=t.getOwnerComponent().getModel();var d=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,t.SalesId),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,t.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"D")];s.read("/getInitialLineItemsSet",{filters:d,success:function(e,s){i.setData(e);t.getView().byId("idExit").setEnabled(true);t.getView().byId("idPrevious").setEnabled(true);t.getView().byId("idNext").setEnabled(true);t.getView().byId("idInputCollId").setEnabled(true);t.getView().byId("idGrade").setEnabled(true);t.getView().byId("idCenter").setEnabled(true);t.getView().byId("idCorner").setEnabled(true);t.getView().byId("idEdge").setEnabled(true);t.getView().byId("idSurface").setEnabled(true);t.getView().byId("idAutoGrade").setEnabled(true);t.getView().byId("idNoGrade").setEnabled(true);t.getView().byId("idBump").setEnabled(true);t.getView().byId("idPerChk").setEnabled(true)}.bind(this),error:function(){}})}}})}if(this.getView().byId("idFinish").getSelected()===true){this.LineId=this.getView().byId("idGradLine").getText();var i=this.getView().byId("idGrade").getSelectedKey();var s=this.getView().byId("idNoGrade").getSelectedKey();var d=new sap.ui.model.json.JSONModel;var a=this.getOwnerComponent().getModel();var l=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,"G")];a.read("/getInitialLineItemsSet",{filters:l,success:function(e,l){d.setData(e);if(e.results.length!==0){if(e.results[0].Posnr!==""&&i===""||e.results[0].Posnr!==""&&s===""){var o="There are ungraded items on this order against the item no ";var n=this.LineId;var g=o.concat(n);this.getView().byId("idFinish").setSelected(false);r.error(g)}}else{var u;var h=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,this.LineId)];r.confirm("Do you want to complete the Grading for this order?, click OK & Save to confirm",{actions:[r.Action.OK,r.Action.CANCEL],emphasizedAction:r.Action.OK,onClose:function(e){if(e==="OK"){a.read("/getInitialLineItemsSet",{filters:h,success:function(e,t){d.setData(e);u="X"}.bind(this),error:function(){}});t.onSave()}if(e==="CANCEL"){t.getView().byId("idFinish").setSelected(false)}}})}}.bind(this),error:function(){}})}},onGraderInfoClik:function(e){var t=new sap.ui.model.json.JSONModel;this.getView().setModel(t,"GraderInfoModel");var i=new sap.ui.model.json.JSONModel;var s=this.getOwnerComponent().getModel();var d=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,this.SalesId),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,this.LineId)];s.read("/getGraderInfoSet",{filters:d,success:function(e,t){i.setData(e);if(e.results.length!==0){this.giCount=e.results[0].ExCount;sap.ui.getCore().byId("idGraderInfLbl").setValue(this.giCount)}this.getView().getModel("GraderInfoModel").setData(e.results);this.getView().getModel("GraderInfoModel").refresh()}.bind(this),error:function(){}});this.gDialog=a.load({name:"CCGSDGRADINGAPP.ZSD_GRADINGAPP.view.fragment.GraderInfo",controller:this}).then(function(e){this.getView().addDependent(e);e.open()}.bind(this))},onDispStatus:function(e){var t=new sap.ui.model.json.JSONModel;this.getView().setModel(t,"userStatusModel");var i=new sap.ui.model.json.JSONModel;var s=this.getOwnerComponent().getModel();var d=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesId)];s.read("/UserStatusSet",{filters:d,success:function(e,t){i.setData(e);this.getView().getModel("userStatusModel").setData(e.results);this.getView().getModel("userStatusModel").refresh()}.bind(this),error:function(){}});this.uDialog=a.load({name:"CCGSDGRADINGAPP.ZSD_GRADINGAPP.view.fragment.Userstatus",controller:this}).then(function(e){this.getView().addDependent(e);e.open()}.bind(this))},onMoreImages:function(e){var t=new sap.ui.model.json.JSONModel;var i=this.getOwnerComponent().getModel();var s=[new sap.ui.model.Filter("CertType",sap.ui.model.FilterOperator.EQ,"I"),new sap.ui.model.Filter("CertId",sap.ui.model.FilterOperator.EQ,this.Collid)];i.read("/Image_displaySet",{filters:s,success:function(e,i){t.setData(e);if(e.results.length!==0){this.s3Url=e.results[0].FrontUrl;window.open(this.s3Url)}}.bind(this),error:function(){}})},OnGraderClose:function(e){sap.ui.getCore().byId("GradDialog").destroy()},OnUserClose:function(e){sap.ui.getCore().byId("UserDialog").destroy()},onNoGradeChange:function(e){var t=this.getView().byId("idNoGrade").getSelectedKey();if(t!==""){this.getView().byId("idCenter").setValue();this.getView().byId("idCorner").setValue();this.getView().byId("idEdge").setValue();this.getView().byId("idSurface").setValue();this.getView().byId("idGrade").setValue();this.getView().byId("idAutoGrade").setValue();this.getView().byId("idPerChk").setSelected(false);this.getView().byId("idPristineChk").setSelected(false);this.getView().byId("idGrade").setEnabled(false);this.getView().byId("idCenter").setEnabled(false);this.getView().byId("idCorner").setEnabled(false);this.getView().byId("idEdge").setEnabled(false);this.getView().byId("idSurface").setEnabled(false);this.getView().byId("idAutoGrade").setEnabled(false);this.getView().byId("idPerChk").setEnabled(false);this.getView().byId("idPristineChk").setEnabled(false)}if(t===""){this.getView().byId("idGrade").setEnabled(true);this.getView().byId("idCenter").setEnabled(true);this.getView().byId("idCorner").setEnabled(true);this.getView().byId("idEdge").setEnabled(true);this.getView().byId("idSurface").setEnabled(true);this.getView().byId("idAutoGrade").setEnabled(true);this.getView().byId("idPerChk").setEnabled(true);this.getView().byId("idPristineChk").setEnabled(true)}},filterGlobally:function(e){var t=e.getParameter("query");this._oGlobalFilter=null;if(t){this._oGlobalFilter=new i([new i("Name",s.Contains,t),new i("Category",s.Contains,t)],false)}this._filter()},_filter:function(){var e=null;if(this._oGlobalFilter&&this._oPriceFilter){e=new i([this._oGlobalFilter,this._oPriceFilter],true)}else if(this._oGlobalFilter){e=this._oGlobalFilter}else if(this._oPriceFilter){e=this._oPriceFilter}this.byId("idGradeTablef").getBinding().filter(e,"Application")},clearAllFilters:function(e){var t=this.byId("idGradeTablef");var i=this.getView().getModel("ui");i.setProperty("/globalFilter","");i.setProperty("/availabilityFilterOn",false);this._oGlobalFilter=null;this._oPriceFilter=null;this._filter();var s=t.getColumns();for(var d=0;d<s.length;d++){t.filter(s[d],null)}}})});