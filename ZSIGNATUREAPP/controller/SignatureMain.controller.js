sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,a,n){"use strict";return e.extend("SS.signaturescan.controller.SignatureMain",{onInit:function(){this.oModel=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSIGNATUREAPP_SRV/");this.getSignatureData("S","SignedModel");this.getSignatureData("T","ArtistName");this.onTableDefaultmodel([]);this.getViewInfo();var e=this.getMyComponent().getComponentData().startupParameters;if(e.SaleOrder){this.SalesOrderNo=e.SaleOrder[0];this.LineNo=e.LineItem[0];this.getSalesOrderData(this.SalesOrderNo,this.LineNo)}},getMyComponent:function(){"use strict";var e=sap.ui.core.Component.getOwnerIdFor(this.getView());return sap.ui.component(e)},getSalesOrderData:function(e,t){var i=this;var a=[new sap.ui.model.Filter("Vbeln",sap.ui.model.FilterOperator.EQ,e),new sap.ui.model.Filter("Posnr",sap.ui.model.FilterOperator.EQ,t)];this.oModel.read("/SignatureSet",{filters:a,success:function(e,t){i.formatData(e.results)},error:function(e){}})},formatData:function(e){var t=this;e.forEach(function(e){var i=e.SignedOn;var a=e.AddedDate;var n=t.getDateFormat("2",i);var s=t.getDateFormat("1",i);var r=t.getDateFormat("1",a);e.SeqNo=e.SeqNo,e.SignatureType=e.SignatureType,e.ArtistName=e.ArtistName,e.Abbrevation=e.Labellines1,e.SignedDate=e.SignedOn,e.SignedOn=n,e.PrintSort=e.Mandt,e.Mandt=s,e.AddedBy=e.AddedBy,e.AddedDate=r});t.onTableDefaultmodel(e);this.SignatureLblLines(e)},getViewInfo:function(){var e=this;this.oModel.read("/SignatureSet",{success:function(t,i){e.AddedBy=t.results[0].AddedBy;e.CreatedOn=t.results[0].AddedDate}})},onTableDefaultmodel:function(e){var t=new sap.ui.model.json.JSONModel(e);this.getView().setModel(t,"osignatureTbldata")},getDateFormat:function(e,t){this.year1=t.getFullYear();this.mes1=t.getMonth()+1;this.dia1=t.getDate();if(this.mes1.toString().length==1){this.mes1="0"+this.mes1}if(this.dia1.toString().length==1){this.dia1="0"+this.dia1}if(e=="1"){return this.year1+"-"+this.mes1+"-"+this.dia1}else if(e=="2"){return this.mes1+"/"+this.dia1+"/"+this.year1}},onAddEnter:function(){var e=this;this.SelctedItems=[];this.Date=this.getView().byId("DateId").getDateValue();this.SignedDateFormat=this.getView().byId("DateId").getValue();var t=this.getView().byId("DateId").getDateValue();this.addId=this.getView().byId("addId").getValue();var i=e.CreatedOn;this.AddedOn=e.getDateFormat("1",i);this.SignedOnformat=e.getDateFormat("1",t);this.SelctedItems=[{SeqNo:0,SignatureType:e.SignTypeText,ArtistName:e.ArtistNameText,Abbrevation:this.ArtistNameTextKey,SignedOn:e.SignedDateFormat,Mandt:this.SignedOnformat,SignedDate:e.Date,AddedBy:e.AddedBy,AddedDate:e.AddedOn,PrintSort:e.SignedTypekey}];var a=this.getView().getModel("osignatureTbldata").oData;if(a.length==0){var n=new sap.ui.model.json.JSONModel(this.SelctedItems);this.getView().setModel(n,"osignatureTbldata")}else{var n=this.getView().getModel("osignatureTbldata").oData;this.getView().getModel("osignatureTbldata").oData=n.concat(this.SelctedItems);this.sortTableData(this.getView().getModel("osignatureTbldata").oData);this.getView().getModel("osignatureTbldata").refresh()}var s=this.getView().getModel("osignatureTbldata").oData;this.SignatureLblLines(s);this.ClearScreenData()},SignatureLblLines:function(e){var t="";var i="";var a;var n;var s;var r;var l;if(e.length>0){for(var o=0;o<e.length;o++){l=e[o].SignedOn;if(o==0){t=t+e[o].SignatureType+" By "+e[o].ArtistName+" On "+e[o].SignedOn;i=i+e[o].SignatureType+" By "+e[o].Abbrevation+" On "+e[o].SignedOn;a=e[o].SignatureType;n=e[o].SignedDate;s=e[o].ArtistName}else{if(a==e[o].SignatureType&&n.getTime()==e[o].SignedDate.getTime()){r="On "+l;var g=t.lastIndexOf(r);var t=t.slice(0,g);var d=i.lastIndexOf(r);var i=i.slice(0,d);t=t+" , "+e[o].ArtistName+" On "+e[o].SignedOn;i=i+" , "+e[o].Abbrevation+" On "+e[o].SignedOn}else if(a==e[o].SignatureType){t=t+" , "+"By "+e[o].ArtistName+" On "+e[o].SignedOn;i=i+" , "+"By "+e[o].Abbrevation+" On "+e[o].SignedOn}else{t=t+" & "+e[o].SignatureType+" By "+e[o].ArtistName+" On "+e[o].SignedOn;i=i+" & "+e[o].SignatureType+" By "+e[o].Abbrevation+" On "+e[o].SignedOn;a=e[o].SignatureType;n=e[o].SignedDate;s=e[o].ArtistName}}}this.FullLabelLines=t;var u=t.match(/.{1,100}/g);var h="";var S="";if(u.length>0){for(var o=0;o<u.length;o++){if(o>3){S=S+u[o]+"\n";this.LabelLines5=u[4];this.LabelLines6=u[5]}else{h=h+u[o]+"\n"}this.LabelLines1=u[0];this.LabelLines2=u[1];this.LabelLines3=u[2];this.LabelLines4=u[3]}}var c=i.match(/.{1,100}/g);var b="";var m="";if(c.length>0){for(var o=0;o<c.length;o++){if(o>3){m=m+c[o]+"\n"}else{b=b+c[o]+"\n"}}}this.getView().byId("SigLblLinesID").setValue(h);this.getView().byId("SigOverLblLines2ID").setValue(S);this.OnBuildLabel=h;this.OnAbbrviation=b;this.labelLine2=S;this.labelLine2Abbr=m}else{this.getView().byId("SigLblLinesID").setValue("");this.getView().byId("SigOverLblLines2ID").setValue("")}},onBuildAbbr:function(){this.getView().byId("SigLblLinesID").setValue(this.OnAbbrviation);this.getView().byId("SigOverLblLines2ID").setValue(this.labelLine2Abbr)},onBuildSignLine:function(){this.getView().byId("SigLblLinesID").setValue(this.OnBuildLabel);this.getView().byId("SigOverLblLines2ID").setValue(this.labelLine2)},sortTableData:function(e){e.sort(function(e,t){if(e.PrintSort===t.PrintSort){return e.SignedDate-t.SignedDate}else{return e.PrintSort-t.PrintSort}})},ClearScreenData:function(){this.getView().byId("DateId").setValue("");this.getView().byId("addId").setValue("");this.getView().byId("sigTypeID").setSelectedKey("");this.getView().byId("sigTypeID").setValue("");this.getView().byId("artistNameID").setValue("");this.getView().byId("artistNameID").setSelectedKey("")},onSignClearPress:function(){this.ClearScreenData()},onSignRemovePress:function(){var e=this.getView().byId("SignatureTbl").getSelectedIndices();e.sort(function(e,t){return t-e});var t=e.length;for(var i=0;i<t;i++){this.getView().getModel("osignatureTbldata").oData.splice(e[i],1)}e=[];this.getView().getModel("osignatureTbldata").refresh();var a=this.getView().getModel("osignatureTbldata").oData;this.SignatureLblLines(a)},onScanInvoicesPress:function(){var e=this,i=this.getView();if(!e.oScanInvoiceDialog){e.oScanInvoiceDialog=t.load({id:i.getId(),name:"SS.signaturescan.fragment.ScanInvoice",controller:e}).then(function(e){e.setModel();i.addDependent(e);return e}.bind(e))}e.oScanInvoiceDialog.then(function(t){t.open();if(e.SalesOrderNo){var i=e.SalesOrderNo.concat(e.LineNo);e.getView().byId("ScanInvoice_SortID").setValue(i);e.getView().byId("ScanInvoice_SortID").setEnabled(false)}});this.osignatureTbldata=this.getView().getModel("osignatureTbldata").oData;this.osignatureTbldata.forEach(function(e){e.SignedOn=e.Mandt+"T00:00:0";e.AddedDate=e.AddedDate+"T00:00:0"})},handleCloseScanPress:function(){var e=this;e.getView().byId("ScanInvoice_SortID").setValue("");this.oScanInvoiceDialog.then(function(e){e.close()});this.osignatureTbldata=this.getView().getModel("osignatureTbldata").oData;this.osignatureTbldata.forEach(function(t){t.SignedOn=e.Date;t.AddedDate=e.AddedOn})},handleSubmitScanPress:function(){var e=this;var t;var i;var a=this.getView().byId("ScanInvoice_SortID").getValue();if(a.length>10){var n=a.match(/.{1,10}/g);t=n[0];i=n[1]}else{t=this.getView().byId("ScanInvoice_SortID").getValue();i=""}e.GetLabelLine(t,i).then(function(t){e.SubmitSignDetails(t)},true)},SubmitSignDetails:function(){var e=this;this.busyDialogCUUpload=new sap.m.BusyDialog({text:"Please wait..."});this.busyDialogCUUpload.open();var t={};var a=this.getView().getModel("osignatureTbldata").oData;a.forEach(function(e){delete e.Abbrevation;delete e.PrintSort;delete e.SignedDate;delete e.Mandt;if(e.SeqNo>0){t.Flag="X"}});var n=this.getView().byId("SigLblLinesID").getValue();var s=this.getView().byId("ScanInvoice_SortID").getValue();if(s.length>10){var r=s.match(/.{1,10}/g);t.Vbeln=r[0];t.Posnr=r[1];if(t.Flag=="X"){t.Flag=""}else{t.Flag="Y"}}else{t.Vbeln=this.getView().byId("ScanInvoice_SortID").getValue();t.Posnr="";t.Flag="Y"}var l=n.match(/.{1,100}/g);if(l.length>0){t.LabelLines1=l[0]}if(l.length>1){t.LabelLines2=l[1]}if(l.length>2){t.LabelLines3=l[2]}if(l.length>3){t.LabelLines4=l[3]}if(l.length>4){t.LabelLines5=l[4]}if(l.length>5){t.LabelLines6=l[5]}t.SignatureSet=this.osignatureTbldata;var o=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZSIGNATUREAPP_SRV/");o.create("/Signature_hdrSet",t,{success:function(t,a){e.busyDialogCUUpload.close();i.success("Successfully Scaned");e.handleCloseScanPress();e.getView().getModel("osignatureTbldata").oData=[];e.getView().getModel("osignatureTbldata").refresh();e.getView().byId("SigLblLinesID").setValue("");e.getView().byId("SigOverLblLines2ID").setValue("")},error:function(t){e.busyDialogCUUpload.close();i.error("failed to update, Please Contact Technical Team ");e.handleCloseScanPress()}})},onSignatureMaintain:function(){var e=this,i=this.getView();if(!e.oSignatureMaintain){e.oSignatureMaintain=t.load({id:i.getId(),name:"SS.signaturescan.fragment.MaintainSign",controller:e}).then(function(e){e.setModel();i.addDependent(e);return e}.bind(e))}e.oSignatureMaintain.then(function(e){e.open()})},handleCloseMntSignPress:function(){this.oSignatureMaintain.then(function(e){e.close()})},onSigTypeDdSelected:function(e){this.SignTypeText=e.getSource().getSelectedItem().getAdditionalText();this.SignTypeValue=e.mParameters.value;this.SignedTypekey=this.getView().byId("sigTypeID").getSelectedKey()},onArtNameSelected:function(e){this.ArtistNameText=e.getParameters().selectedItem.mProperties.text;this.ArtistNameTextKey=e.getParameters().selectedItem.mProperties.key},getSignatureData:function(e,t){var i=[new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,e)];this.oModel.read("/Sign_DropDownSet",{filters:i,success:function(e,i){var a=new sap.ui.model.json.JSONModel(e.results);if(t=="ArtistName"){a.setSizeLimit(1e5)}this.getView().setModel(a,t)}.bind(this),error:function(){MessageToast.show("Sub-Grades failed to Load, Please Contact Technical Team")}})},onBtnSignMntPress:function(){var e=this;var t=this.getView().byId("CG_SignTypeCode").getValue();var a=this.getView().byId("SignDesc").getValue();var n=this.getView().byId("CG_SignDisplaySort").getValue();var s=this.getView().byId("CG_SignPrintSort").getValue();var r={};r.ImFlag="S";r.LvPosnr=n;r.LvVbeln=s;r.CharValue=t;r.DescrCval=a;r.NameChar="";r.Name="";this.oModel.create("/Sign_DropDownSet",r,{success:function(t,a){i.success("Signature type Saved successfully");e.handleCloseMntSignPress();e.SignTypeInputClear();e.getSignatureData("S","SignedModel")},error(t){i.error(" failed to update Sign type, Please Contact Technical Team");e.handleCloseMntSignPress()}})},SignTypeInputClear:function(){this.getView().byId("CG_SignTypeCode").setValue("");this.getView().byId("SignDesc").setValue("");this.getView().byId("CG_SignDisplaySort").setValue("");this.getView().byId("CG_SignPrintSort").setValue("")},onBtnArtNameclearPress:function(){this.getView().byId("FirstNameID_MS").setValue("");this.getView().byId("LastNameID_MS").setValue("");this.getView().byId("FullNameID_MS").setValue("")},onNameChnage:function(){this.FullName=this.getView().byId("FirstNameID_MS").getValue()+" "+this.getView().byId("LastNameID_MS").getValue();this.Abbrevation=this.getView().byId("FirstNameID_MS").getValue().charAt(0)+" "+this.getView().byId("LastNameID_MS").getValue();this.getView().byId("FullNameID_MS").setValue(this.FullName);this.getView().byId("AbbreviationID_MS").setValue(this.Abbrevation)},onBtnArtNamePress:function(){var e=this;var t=this.getView().byId("FirstNameID_MS").getValue();var a=this.getView().byId("LastNameID_MS").getValue();var n=this.getView().byId("FullNameID_MS").getValue();var s=this.getView().byId("AbbreviationID_MS").getValue();var r={};r.ImFlag="A";r.LvPosnr="1";r.LvVbeln="1";r.CharValue=t;r.DescrCval=a;r.NameChar=n;r.Name=s;this.oModel.create("/Sign_DropDownSet",r,{success:function(t,a){i.success("Artist Name Saved successfully");e.handleCloseMntSignPress();e.onBtnArtNameclearPress();e.getSignatureData("T","ArtistName")},error(t){i.error(" failed to update Artist Name, Please Contact Technical Team");e.handleCloseMntSignPress()}})},GetLabelLine:function(e,t){return new Promise(function(e,t){e(this)}.bind(this))},getNextLineItem:function(e){return new Promise(function(t,i){var a=this;var n=[new sap.ui.model.Filter("LvVbeln",sap.ui.model.FilterOperator.EQ,this.SalesOrderNumber),new sap.ui.model.Filter("LvPosnr",sap.ui.model.FilterOperator.EQ,this.LineId),new sap.ui.model.Filter("ImFlag",sap.ui.model.FilterOperator.EQ,e)];this.oModel.read("/Grade_MARADATASet",{filters:n,success:function(e,i){t(e.results[0].ExtRefItemId)},error(e){}})}.bind(this))},onVHArtist:function(e){var i=e.getSource().getValue(),s=this.getView();if(!this._pValueHelpDialog){this._pValueHelpDialog=t.load({id:s.getId(),name:"SS.signaturescan.fragment.ValueHelpDialog",controller:this}).then(function(e){s.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){e.getBinding("items").filter([new a("CharValue",n.Contains,i)]);e.open(i)})},onValueHelpDialogSearch:function(e){var t=e.getParameter("value");var i=new a("CharValue",n.Contains,t);e.getSource().getBinding("items").filter([i])},onValueHelpDialogClose:function(e){var t,i,a=e.getParameter("selectedItem");e.getSource().getBinding("items").filter([]);if(!a){return}t=a.getDescription();i=a.getTitle();this.byId("artistNameID").setSelectedKey(t);this.ArtistNameText=i;this.ArtistNameTextKey=t},onSuggestionItemSelected:function(e){var t=e.getParameter("selectedItem");var i=t?t.getKey():"";this.byId("selectedKeyIndicator").setText(i)}})});
//# sourceMappingURL=SignatureMain.controller.js.map